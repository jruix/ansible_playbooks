---
- selinux: state=disabled

- name: Install httpd
  yum: name=httpd state=present
  notify:
      - restart apache

#- name: upgrade CentOS
#  yum: name=* state=present

- name: Install wget
  yum: name=wget state=present

#- name: Install mysql
#  yum: name=mysql state=present

- name: Downloading and enable the EPEL repository definitions.
  action: command rpm -Uvh --replacepkgs http://dl.fedoraproject.org/pub/epel/beta/7/x86_64/epel-release-7-1.noarch.rpm

- name: Install git
  yum: name=git state=present

- name: install PHP
  yum: name=php state=present
  notify:
      - restart apache

- name: install php-xml
  yum: name=php-xml state=present
  notify:
      - restart apache

- name: install php-pdo
  yum: name=php-pdo state=present
  notify:
      - restart apache

- name: install php-mcrypt
  yum: name=php-mcrypt state=present
  notify:
      - restart apache

- name: install php-gd
  yum: name=php-mcrypt state=present
  notify:
      - restart apache

- name: install PHP mysql module for Apache
  yum: name=php-mysql state=present
  notify:
      - restart apache

- name: Enable mod rewrite
  replace: dest=/etc/httpd/conf/httpd.conf regexp='AllowOverride None' replace='AllowOverride All' backup=yes validate='/usr/sbin/apache2ctl -f %s -t'
  notify:
      - restart apache

- name: start Apache
  service: name=httpd state=running enabled=yes

# CentOs 7 firwalld is breaking Azure endpoints (port 80)
- name: Stop service firewalld (Linux)
  shell: systemctl disable firewalld; systemctl stop firewalld

# ASL (Atomic Secured Linux)
#- name: Copy ASL configuration
#  copy: src=asl.cfg dest=~/ansible/asl/
#
#- name: Download ASL installer
#  get_url: url=https://www.atomicorp.com/installers/asl dest=~/ansible/asl/installer.sh
#
#- name: Execute ASL unatended installation
#  command: chdir=~/ansible/asl/ /bin/sh ~/ansible/asl/installer.sh

## Virtualmin
#- name: Copy unatended VIRTUALMIN installation script
#  copy: src=unatended_virtualmin_install.sh dest=~/ansible/virtualmin/
#
#- name: Execute VIRTUALMIN unatended installation
#  command: chdir=~/ansible/virtualmin/ /bin/sh ~/ansible/virtualmin/unatended_virtualmin_install.sh {{ server_hostname }}